<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SEO Analysis Comparison</title>
	<style>
		:root {
			--bg-primary: #0f172a;
			--bg-secondary: #1e293b;
			--bg-tertiary: #334155;
			--text-primary: #f1f5f9;
			--text-secondary: #94a3b8;
			--text-muted: #64748b;
			--accent: #3b82f6;
			--accent-hover: #2563eb;
			--success: #22c55e;
			--warning: #f59e0b;
			--danger: #ef4444;
			--border: #475569;
			--page-a: #f472b6;
			--page-b: #38bdf8;
		}

		* { box-sizing: border-box; margin: 0; padding: 0; }

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: var(--bg-primary);
			color: var(--text-primary);
			line-height: 1.6;
			min-height: 100vh;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
			padding: 1.5rem;
		}

		header {
			text-align: center;
			margin-bottom: 2rem;
		}

		header h1 {
			font-size: 2rem;
			margin-bottom: 0.5rem;
			background: linear-gradient(135deg, var(--page-a), var(--page-b));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		header p {
			color: var(--text-secondary);
		}

		/* Input Section */
		.input-section {
			background: var(--bg-secondary);
			border-radius: 12px;
			padding: 1.5rem;
			margin-bottom: 2rem;
			border: 1px solid var(--border);
		}

		.input-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1.5rem;
		}

		.input-panel {
			display: flex;
			flex-direction: column;
		}

		.input-panel h3 {
			font-size: 1rem;
			margin-bottom: 0.75rem;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.input-panel.page-a h3 { color: var(--page-a); }
		.input-panel.page-b h3 { color: var(--page-b); }

		.indicator {
			width: 10px;
			height: 10px;
			border-radius: 50%;
			background: var(--bg-tertiary);
		}

		.indicator.loaded { background: var(--success); }

		.input-actions {
			display: flex;
			gap: 0.5rem;
			flex-wrap: wrap;
			margin-bottom: 0.75rem;
		}

		.btn {
			background: var(--accent);
			color: white;
			border: none;
			padding: 0.5rem 1rem;
			border-radius: 6px;
			cursor: pointer;
			font-size: 0.85rem;
			transition: all 0.2s;
		}

		.btn:hover { background: var(--accent-hover); }
		.btn-secondary { background: var(--bg-tertiary); }
		.btn-secondary:hover { background: var(--border); }
		.btn-compare {
			background: linear-gradient(135deg, var(--page-a), var(--page-b));
			padding: 0.75rem 2rem;
			font-size: 1rem;
			font-weight: 600;
		}

		input[type="file"] { display: none; }

		textarea {
			width: 100%;
			min-height: 100px;
			background: var(--bg-primary);
			border: 1px solid var(--border);
			border-radius: 8px;
			padding: 0.75rem;
			color: var(--text-primary);
			font-family: 'Monaco', 'Menlo', monospace;
			font-size: 0.8rem;
			resize: vertical;
			display: none;
		}

		textarea:focus { outline: none; border-color: var(--accent); }
		textarea.visible { display: block; }

		.compare-actions {
			display: flex;
			justify-content: center;
			gap: 1rem;
			margin-top: 1.25rem;
			padding-top: 1.25rem;
			border-top: 1px solid var(--border);
		}

		.message {
			padding: 0.75rem 1rem;
			border-radius: 8px;
			margin-top: 1rem;
			display: none;
			font-size: 0.9rem;
		}

		.message.error {
			background: rgba(239, 68, 68, 0.2);
			border: 1px solid var(--danger);
			color: var(--danger);
			display: block;
		}

		.message.success {
			background: rgba(34, 197, 94, 0.2);
			border: 1px solid var(--success);
			color: var(--success);
			display: block;
		}

		/* Results Dashboard */
		.dashboard {
			display: none;
		}

		.dashboard.visible {
			display: block;
		}

		/* Winner Banner */
		.winner-banner {
			background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
			border-radius: 16px;
			padding: 2rem;
			text-align: center;
			margin-bottom: 2rem;
			border: 2px solid var(--border);
			position: relative;
			overflow: hidden;
		}

		.winner-banner::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 4px;
		}

		.winner-banner.winner-a::before { background: var(--page-a); }
		.winner-banner.winner-b::before { background: var(--page-b); }
		.winner-banner.tie::before { background: linear-gradient(90deg, var(--page-a), var(--page-b)); }

		.winner-label {
			font-size: 0.9rem;
			color: var(--text-secondary);
			margin-bottom: 0.5rem;
			text-transform: uppercase;
			letter-spacing: 0.1em;
		}

		.winner-title {
			font-size: 1.5rem;
			font-weight: 700;
			margin-bottom: 0.5rem;
			word-break: break-word;
		}

		.winner-banner.winner-a .winner-title { color: var(--page-a); }
		.winner-banner.winner-b .winner-title { color: var(--page-b); }
		.winner-banner.tie .winner-title {
			background: linear-gradient(135deg, var(--page-a), var(--page-b));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.winner-score {
			font-size: 3rem;
			font-weight: 800;
			margin: 1rem 0;
		}

		.winner-banner.winner-a .winner-score { color: var(--page-a); }
		.winner-banner.winner-b .winner-score { color: var(--page-b); }

		.score-breakdown {
			display: flex;
			justify-content: center;
			gap: 2rem;
			margin-top: 1rem;
		}

		.score-item {
			text-align: center;
		}

		.score-item .label {
			font-size: 0.8rem;
			color: var(--text-secondary);
		}

		.score-item .value {
			font-size: 1.75rem;
			font-weight: 700;
		}

		.score-item.page-a .value { color: var(--page-a); }
		.score-item.page-b .value { color: var(--page-b); }

		/* Page Info Cards */
		.page-cards {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
			margin-bottom: 2rem;
		}

		.page-card {
			background: var(--bg-secondary);
			border-radius: 12px;
			padding: 1.25rem;
			border: 2px solid var(--border);
		}

		.page-card.page-a { border-color: var(--page-a); }
		.page-card.page-b { border-color: var(--page-b); }

		.page-card h4 {
			font-size: 0.9rem;
			margin-bottom: 0.5rem;
		}

		.page-card.page-a h4 { color: var(--page-a); }
		.page-card.page-b h4 { color: var(--page-b); }

		.page-card .url {
			font-size: 0.8rem;
			color: var(--text-secondary);
			word-break: break-all;
			margin-bottom: 0.5rem;
		}

		.page-card .url a {
			color: var(--accent);
			text-decoration: none;
		}

		.page-card .title {
			font-size: 1rem;
			font-weight: 600;
		}

		/* Category Sections */
		.category {
			background: var(--bg-secondary);
			border-radius: 12px;
			margin-bottom: 1rem;
			border: 1px solid var(--border);
			overflow: hidden;
		}

		.category-header {
			padding: 1rem 1.25rem;
			cursor: pointer;
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: var(--bg-tertiary);
			user-select: none;
		}

		.category-header:hover { background: var(--border); }

		.category-header h3 {
			font-size: 1rem;
			display: flex;
			align-items: center;
			gap: 0.75rem;
		}

		.category-header .category-score {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.category-winner {
			padding: 0.25rem 0.75rem;
			border-radius: 20px;
			font-size: 0.75rem;
			font-weight: 600;
		}

		.category-winner.page-a {
			background: rgba(244, 114, 182, 0.2);
			color: var(--page-a);
		}

		.category-winner.page-b {
			background: rgba(56, 189, 248, 0.2);
			color: var(--page-b);
		}

		.category-winner.tie {
			background: rgba(148, 163, 184, 0.2);
			color: var(--text-secondary);
		}

		.chevron {
			transition: transform 0.2s;
			font-size: 0.8rem;
			color: var(--text-secondary);
		}

		.category-header.open .chevron { transform: rotate(180deg); }

		.category-content {
			display: none;
			padding: 1.25rem;
		}

		.category-content.open { display: block; }

		/* Metric Rows */
		.metric-row {
			display: grid;
			grid-template-columns: 2fr 1fr 1fr 80px;
			gap: 1rem;
			padding: 0.75rem;
			border-radius: 8px;
			margin-bottom: 0.5rem;
			background: var(--bg-primary);
			align-items: center;
		}

		.metric-row:last-child { margin-bottom: 0; }

		.metric-name {
			font-weight: 500;
		}

		.metric-name .description {
			font-size: 0.75rem;
			color: var(--text-muted);
			font-weight: 400;
		}

		.metric-value {
			text-align: center;
			font-family: 'Monaco', 'Menlo', monospace;
			font-size: 0.9rem;
		}

		.metric-value.page-a { color: var(--page-a); }
		.metric-value.page-b { color: var(--page-b); }

		.metric-verdict {
			text-align: center;
		}

		.verdict-badge {
			display: inline-block;
			padding: 0.2rem 0.5rem;
			border-radius: 4px;
			font-size: 0.7rem;
			font-weight: 600;
		}

		.verdict-badge.winner-a {
			background: rgba(244, 114, 182, 0.2);
			color: var(--page-a);
		}

		.verdict-badge.winner-b {
			background: rgba(56, 189, 248, 0.2);
			color: var(--page-b);
		}

		.verdict-badge.tie {
			background: rgba(148, 163, 184, 0.2);
			color: var(--text-secondary);
		}

		.verdict-badge.issue {
			background: rgba(239, 68, 68, 0.2);
			color: var(--danger);
		}

		/* SEO Issues */
		.issues-section {
			margin-top: 1rem;
			padding-top: 1rem;
			border-top: 1px solid var(--border);
		}

		.issues-section h4 {
			font-size: 0.9rem;
			color: var(--text-secondary);
			margin-bottom: 0.75rem;
		}

		.issue-item {
			display: flex;
			align-items: flex-start;
			gap: 0.5rem;
			padding: 0.5rem;
			background: rgba(239, 68, 68, 0.1);
			border-radius: 6px;
			margin-bottom: 0.5rem;
			font-size: 0.85rem;
		}

		.issue-item .icon { color: var(--danger); }
		.issue-item.page-a { border-left: 3px solid var(--page-a); }
		.issue-item.page-b { border-left: 3px solid var(--page-b); }

		/* Content Preview */
		.content-preview {
			background: var(--bg-primary);
			border-radius: 8px;
			padding: 1rem;
			margin-top: 1rem;
		}

		.content-preview h4 {
			font-size: 0.85rem;
			color: var(--text-secondary);
			margin-bottom: 0.75rem;
		}

		.preview-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
		}

		.preview-panel {
			padding: 0.75rem;
			border-radius: 6px;
			max-height: 200px;
			overflow-y: auto;
			font-size: 0.8rem;
		}

		.preview-panel.page-a {
			background: rgba(244, 114, 182, 0.1);
			border: 1px solid rgba(244, 114, 182, 0.3);
		}

		.preview-panel.page-b {
			background: rgba(56, 189, 248, 0.1);
			border: 1px solid rgba(56, 189, 248, 0.3);
		}

		.preview-panel h5 {
			font-size: 0.75rem;
			margin-bottom: 0.5rem;
		}

		.preview-panel.page-a h5 { color: var(--page-a); }
		.preview-panel.page-b h5 { color: var(--page-b); }

		/* Schema Tags */
		.schema-tags {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
		}

		.schema-tag {
			padding: 0.25rem 0.5rem;
			border-radius: 4px;
			font-size: 0.75rem;
			background: var(--bg-tertiary);
		}

		.schema-tag.page-a { border-left: 2px solid var(--page-a); }
		.schema-tag.page-b { border-left: 2px solid var(--page-b); }
		.schema-tag.both { border-left: 2px solid var(--success); }

		/* Heading Tree */
		.heading-tree {
			font-family: 'Monaco', 'Menlo', monospace;
			font-size: 0.8rem;
		}

		.heading-node {
			padding: 0.2rem 0.5rem;
			margin-left: 1rem;
			border-left: 2px solid var(--border);
			margin-bottom: 0.2rem;
		}

		.heading-node.h1 { margin-left: 0; border-color: var(--accent); }
		.heading-node.h2 { border-color: var(--success); }
		.heading-node.h3 { border-color: var(--warning); }
		.heading-node.h4 { border-color: var(--danger); }

		.heading-tag {
			display: inline-block;
			background: var(--bg-tertiary);
			padding: 0.1rem 0.3rem;
			border-radius: 3px;
			font-size: 0.65rem;
			margin-right: 0.4rem;
			color: var(--text-muted);
		}

		/* Footer */
		footer {
			text-align: center;
			padding: 2rem;
			color: var(--text-secondary);
			font-size: 0.8rem;
		}

		footer a {
			color: var(--accent);
			text-decoration: none;
		}

		/* Classification Section */
		.classification-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
		}

		.classification-panel {
			background: var(--bg-primary);
			border-radius: 8px;
			padding: 1rem;
		}

		.classification-panel.page-a { border-left: 3px solid var(--page-a); }
		.classification-panel.page-b { border-left: 3px solid var(--page-b); }

		.classification-type {
			display: inline-block;
			padding: 0.3rem 0.6rem;
			border-radius: 6px;
			font-size: 0.85rem;
			font-weight: 600;
			background: var(--bg-tertiary);
			margin-bottom: 0.5rem;
		}

		.classification-subtype {
			font-size: 0.8rem;
			color: var(--text-secondary);
			margin-bottom: 0.75rem;
		}

		.classification-summary {
			font-size: 0.85rem;
			line-height: 1.5;
			color: var(--text-primary);
			margin-bottom: 0.75rem;
		}

		.themes-container {
			display: flex;
			flex-wrap: wrap;
			gap: 0.4rem;
		}

		.theme-tag {
			padding: 0.2rem 0.5rem;
			border-radius: 12px;
			font-size: 0.7rem;
			background: var(--bg-tertiary);
			color: var(--text-secondary);
		}

		.theme-tag.page-a { background: rgba(244, 114, 182, 0.2); color: var(--page-a); }
		.theme-tag.page-b { background: rgba(56, 189, 248, 0.2); color: var(--page-b); }
		.theme-tag.shared { background: rgba(34, 197, 94, 0.2); color: var(--success); }

		.no-classification {
			color: var(--text-muted);
			font-style: italic;
			font-size: 0.85rem;
		}

		/* Scrollbar */
		::-webkit-scrollbar { width: 8px; height: 8px; }
		::-webkit-scrollbar-track { background: var(--bg-primary); }
		::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
		::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

		@media (max-width: 900px) {
			.input-grid,
			.page-cards,
			.preview-grid,
			.metric-row {
				grid-template-columns: 1fr;
			}

			.metric-row {
				gap: 0.5rem;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<header>
			<h1>üîç SEO Analysis Comparison</h1>
			<p>Compare two pages from an SEO perspective to determine which performs better</p>
		</header>

		<section class="input-section">
			<div class="input-grid">
				<div class="input-panel page-a">
					<h3><span class="indicator" id="indicatorA"></span> Page A</h3>
					<div class="input-actions">
						<label class="btn btn-secondary">
							üìÅ Load JSON
							<input type="file" id="fileInputA" accept=".json">
						</label>
						<button class="btn btn-secondary" id="pasteA">üìã Paste</button>
						<button class="btn btn-secondary" id="clearA" style="display:none">‚úï Clear</button>
					</div>
					<textarea id="jsonInputA" placeholder="Paste StructuredAnalysis JSON here..."></textarea>
				</div>
				<div class="input-panel page-b">
					<h3><span class="indicator" id="indicatorB"></span> Page B</h3>
					<div class="input-actions">
						<label class="btn btn-secondary">
							üìÅ Load JSON
							<input type="file" id="fileInputB" accept=".json">
						</label>
						<button class="btn btn-secondary" id="pasteB">üìã Paste</button>
						<button class="btn btn-secondary" id="clearB" style="display:none">‚úï Clear</button>
					</div>
					<textarea id="jsonInputB" placeholder="Paste StructuredAnalysis JSON here..."></textarea>
				</div>
			</div>
			<div class="compare-actions">
				<button class="btn btn-compare" id="compareBtn" disabled>üîç Compare SEO Performance</button>
			</div>
			<div class="message" id="message"></div>
		</section>

		<div class="dashboard" id="dashboard"></div>
	</div>

	<footer>
		<p>Part of the <a href="#">Cuery Analysis Tools</a> ‚Ä¢ <a href="analysis-diff.html">Diff View</a> ‚Ä¢ <a href="analysis-viewer.html">Single Viewer</a></p>
	</footer>

	<script>
		// State
		let pageA = null;
		let pageB = null;

		// DOM Elements
		const fileInputA = document.getElementById('fileInputA');
		const fileInputB = document.getElementById('fileInputB');
		const pasteA = document.getElementById('pasteA');
		const pasteB = document.getElementById('pasteB');
		const clearA = document.getElementById('clearA');
		const clearB = document.getElementById('clearB');
		const jsonInputA = document.getElementById('jsonInputA');
		const jsonInputB = document.getElementById('jsonInputB');
		const indicatorA = document.getElementById('indicatorA');
		const indicatorB = document.getElementById('indicatorB');
		const compareBtn = document.getElementById('compareBtn');
		const messageEl = document.getElementById('message');
		const dashboard = document.getElementById('dashboard');

		// Utilities
		function showMessage(text, type = 'error') {
			messageEl.textContent = text;
			messageEl.className = `message ${type}`;
			setTimeout(() => messageEl.className = 'message', 5000);
		}

		function escapeHtml(text) {
			if (text == null) return '';
			const div = document.createElement('div');
			div.textContent = String(text);
			return div.innerHTML;
		}

		function parseJSON(text) {
			const data = JSON.parse(text);
			if (!data.url) throw new Error('Invalid StructuredAnalysis: missing "url"');
			data.content = data.content || {};
			data.stats = data.stats || {};
			return data;
		}

		function updateCompareButton() {
			compareBtn.disabled = !(pageA && pageB);
		}

		function loadPage(side, text) {
			try {
				const data = parseJSON(text);
				if (side === 'A') {
					pageA = data;
					indicatorA.classList.add('loaded');
					clearA.style.display = 'inline-block';
					jsonInputA.classList.remove('visible');
				} else {
					pageB = data;
					indicatorB.classList.add('loaded');
					clearB.style.display = 'inline-block';
					jsonInputB.classList.remove('visible');
				}
				updateCompareButton();
				const title = data.content?.meta?.title || data.url;
				showMessage(`Page ${side} loaded: ${title.substring(0, 60)}...`, 'success');
			} catch (e) {
				showMessage(`Page ${side} error: ${e.message}`);
			}
		}

		function clearPage(side) {
			if (side === 'A') {
				pageA = null;
				indicatorA.classList.remove('loaded');
				clearA.style.display = 'none';
				jsonInputA.value = '';
			} else {
				pageB = null;
				indicatorB.classList.remove('loaded');
				clearB.style.display = 'none';
				jsonInputB.value = '';
			}
			updateCompareButton();
			dashboard.classList.remove('visible');
		}

		// SEO Scoring Logic
		const SEO_CRITERIA = {
			content: {
				name: 'üìù Content Quality',
				metrics: [
					{
						id: 'wordCount',
						name: 'Word Count',
						description: 'Longer content typically ranks better (aim for 1500+ words)',
						getValue: (p) => p.stats?.numWords || 0,
						compare: 'higher',
						ideal: 1500
					},
					{
						id: 'paragraphs',
						name: 'Paragraphs',
						description: 'Well-structured content with multiple paragraphs',
						getValue: (p) => p.stats?.numParagraphs || 0,
						compare: 'higher',
						ideal: 10
					},
					{
						id: 'avgParagraphLength',
						name: 'Avg Paragraph Length',
						description: 'Optimal: 40-80 chars (readable chunks)',
						getValue: (p) => p.stats?.avgParagraphLength || 0,
						compare: 'range',
						idealMin: 40,
						idealMax: 80
					},
					{
						id: 'questions',
						name: 'Questions Addressed',
						description: 'Content that answers questions performs well',
						getValue: (p) => p.stats?.numQuestions || 0,
						compare: 'higher'
					},
					{
						id: 'lists',
						name: 'Lists',
						description: 'Lists improve readability and featured snippet chances',
						getValue: (p) => p.stats?.numLists || 0,
						compare: 'higher'
					},
					{
						id: 'tables',
						name: 'Tables',
						description: 'Structured data tables can trigger rich results',
						getValue: (p) => p.stats?.numTables || 0,
						compare: 'higher'
					}
				]
			},
			headings: {
				name: 'üìë Heading Structure',
				metrics: [
					{
						id: 'oneH1',
						name: 'Single H1',
						description: 'Best practice: exactly one H1 per page',
						getValue: (p) => p.stats?.headingStats?.oneH1 ? 1 : 0,
						compare: 'boolean',
						ideal: true
					},
					{
						id: 'totalHeadings',
						name: 'Total Headings',
						description: 'Headings help structure content (aim for 5-15)',
						getValue: (p) => p.stats?.headingStats?.totalHeadings || 0,
						compare: 'range',
						idealMin: 5,
						idealMax: 15
					},
					{
						id: 'maxDepth',
						name: 'Heading Depth',
						description: 'Deeper hierarchy shows content organization',
						getValue: (p) => p.stats?.headingStats?.maxDepth || 0,
						compare: 'range',
						idealMin: 2,
						idealMax: 4
					},
					{
						id: 'skippedLevels',
						name: 'Skipped Levels',
						description: 'Avoid skipping heading levels (H2‚ÜíH4)',
						getValue: (p) => p.stats?.headingStats?.skippedLevels || 0,
						compare: 'lower',
						ideal: 0
					},
					{
						id: 'emptyHeadings',
						name: 'Empty Headings',
						description: 'Headings should have text content',
						getValue: (p) => p.stats?.headingStats?.emptyHeadings || 0,
						compare: 'lower',
						ideal: 0
					},
					{
						id: 'duplicateHeadings',
						name: 'Duplicate Headings',
						description: 'Unique headings help navigation and SEO',
						getValue: (p) => p.stats?.headingStats?.duplicateHeadings || 0,
						compare: 'lower',
						ideal: 0
					}
				]
			},
			meta: {
				name: 'üè∑Ô∏è Meta & Technical',
				metrics: [
					{
						id: 'hasTitle',
						name: 'Title Tag',
						description: 'Essential for SEO and click-through rates',
						getValue: (p) => p.content?.meta?.title ? 1 : 0,
						compare: 'boolean'
					},
					{
						id: 'titleLength',
						name: 'Title Length',
						description: 'Optimal: 50-60 characters',
						getValue: (p) => (p.content?.meta?.title || '').length,
						compare: 'range',
						idealMin: 50,
						idealMax: 60
					},
					{
						id: 'hasDescription',
						name: 'Meta Description',
						description: 'Important for SERP snippets',
						getValue: (p) => p.content?.meta?.description ? 1 : 0,
						compare: 'boolean'
					},
					{
						id: 'descriptionLength',
						name: 'Description Length',
						description: 'Optimal: 150-160 characters',
						getValue: (p) => (p.content?.meta?.description || '').length,
						compare: 'range',
						idealMin: 150,
						idealMax: 160
					},
					{
						id: 'hasCanonical',
						name: 'Canonical URL',
						description: 'Prevents duplicate content issues',
						getValue: (p) => p.content?.meta?.canonical ? 1 : 0,
						compare: 'boolean'
					}
				]
			},
			schema: {
				name: 'üìã Structured Data',
				metrics: [
					{
						id: 'numSchemas',
						name: 'Schema Count',
						description: 'Structured data enables rich results',
						getValue: (p) => p.stats?.numSchemas || 0,
						compare: 'higher'
					},
					{
						id: 'schemaTypes',
						name: 'Schema Types',
						description: 'Variety of structured data types',
						getValue: (p) => Object.keys(p.stats?.schemaStats || {}).filter(k => p.stats.schemaStats[k]).length,
						compare: 'higher'
					}
				]
			},
			links: {
				name: 'üîó Link Profile',
				metrics: [
					{
						id: 'internalLinks',
						name: 'Internal Links',
						description: 'Help navigation and spread link equity',
						getValue: (p) => p.stats?.numInternalLinks || 0,
						compare: 'higher'
					},
					{
						id: 'externalLinks',
						name: 'External Links',
						description: 'Outbound links to quality sources build trust',
						getValue: (p) => p.stats?.numExternalLinks || 0,
						compare: 'range',
						idealMin: 2,
						idealMax: 10
					},
					{
						id: 'totalLinks',
						name: 'Total Links',
						description: 'Overall link density',
						getValue: (p) => p.stats?.numLinks || 0,
						compare: 'higher'
					}
				]
			},
			engagement: {
				name: '‚ú® Engagement Features',
				metrics: [
					{
						id: 'forms',
						name: 'Forms',
						description: 'Interactive elements for user engagement',
						getValue: (p) => p.stats?.numForms || 0,
						compare: 'higher'
					}
				]
			},
			classification: {
				name: 'üè∑Ô∏è Page Classification',
				metrics: [
					{
						id: 'hasClassification',
						name: 'AI Classification',
						description: 'Page has been classified by AI',
						getValue: (p) => p.classification ? 1 : 0,
						compare: 'boolean'
					},
					{
						id: 'themeCount',
						name: 'Theme Count',
						description: 'Number of themes identified on the page',
						getValue: (p) => p.classification?.themes?.length || 0,
						compare: 'higher'
					}
				]
			}
		};

		function compareMetric(metric, valA, valB) {
			let result = { winner: 'tie', scoreA: 0, scoreB: 0, issueA: null, issueB: null };

			if (metric.compare === 'higher') {
				if (valA > valB) {
					result.winner = 'A';
					result.scoreA = 1;
				} else if (valB > valA) {
					result.winner = 'B';
					result.scoreB = 1;
				} else {
					result.scoreA = 0.5;
					result.scoreB = 0.5;
				}
				// Check ideal
				if (metric.ideal && valA < metric.ideal) {
					result.issueA = `Below ideal (${metric.ideal})`;
				}
				if (metric.ideal && valB < metric.ideal) {
					result.issueB = `Below ideal (${metric.ideal})`;
				}
			} else if (metric.compare === 'lower') {
				if (valA < valB) {
					result.winner = 'A';
					result.scoreA = 1;
				} else if (valB < valA) {
					result.winner = 'B';
					result.scoreB = 1;
				} else {
					result.scoreA = 0.5;
					result.scoreB = 0.5;
				}
				if (metric.ideal !== undefined && valA > metric.ideal) {
					result.issueA = `Should be ${metric.ideal}`;
				}
				if (metric.ideal !== undefined && valB > metric.ideal) {
					result.issueB = `Should be ${metric.ideal}`;
				}
			} else if (metric.compare === 'range') {
				const inRangeA = valA >= metric.idealMin && valA <= metric.idealMax;
				const inRangeB = valB >= metric.idealMin && valB <= metric.idealMax;
				const distA = inRangeA ? 0 : Math.min(Math.abs(valA - metric.idealMin), Math.abs(valA - metric.idealMax));
				const distB = inRangeB ? 0 : Math.min(Math.abs(valB - metric.idealMin), Math.abs(valB - metric.idealMax));

				if (inRangeA && !inRangeB) {
					result.winner = 'A';
					result.scoreA = 1;
				} else if (inRangeB && !inRangeA) {
					result.winner = 'B';
					result.scoreB = 1;
				} else if (distA < distB) {
					result.winner = 'A';
					result.scoreA = 1;
				} else if (distB < distA) {
					result.winner = 'B';
					result.scoreB = 1;
				} else {
					result.scoreA = 0.5;
					result.scoreB = 0.5;
				}

				if (!inRangeA) {
					result.issueA = `Outside ideal range (${metric.idealMin}-${metric.idealMax})`;
				}
				if (!inRangeB) {
					result.issueB = `Outside ideal range (${metric.idealMin}-${metric.idealMax})`;
				}
			} else if (metric.compare === 'boolean') {
				if (valA && !valB) {
					result.winner = 'A';
					result.scoreA = 1;
				} else if (valB && !valA) {
					result.winner = 'B';
					result.scoreB = 1;
				} else if (valA && valB) {
					result.scoreA = 1;
					result.scoreB = 1;
				}
				if (!valA) result.issueA = 'Missing';
				if (!valB) result.issueB = 'Missing';
			}

			return result;
		}

		function computeScores() {
			const results = {
				categories: {},
				totalA: 0,
				totalB: 0,
				maxScore: 0,
				issuesA: [],
				issuesB: []
			};

			for (const [catId, category] of Object.entries(SEO_CRITERIA)) {
				results.categories[catId] = {
					name: category.name,
					metrics: [],
					scoreA: 0,
					scoreB: 0,
					winner: 'tie'
				};

				for (const metric of category.metrics) {
					const valA = metric.getValue(pageA);
					const valB = metric.getValue(pageB);
					const comparison = compareMetric(metric, valA, valB);

					results.categories[catId].metrics.push({
						...metric,
						valA,
						valB,
						...comparison
					});

					results.categories[catId].scoreA += comparison.scoreA;
					results.categories[catId].scoreB += comparison.scoreB;
					results.totalA += comparison.scoreA;
					results.totalB += comparison.scoreB;
					results.maxScore += 1;

					if (comparison.issueA) {
						results.issuesA.push({ category: category.name, metric: metric.name, issue: comparison.issueA });
					}
					if (comparison.issueB) {
						results.issuesB.push({ category: category.name, metric: metric.name, issue: comparison.issueB });
					}
				}

				// Determine category winner
				const cat = results.categories[catId];
				if (cat.scoreA > cat.scoreB) cat.winner = 'A';
				else if (cat.scoreB > cat.scoreA) cat.winner = 'B';
			}

			results.winner = results.totalA > results.totalB ? 'A' :
							 results.totalB > results.totalA ? 'B' : 'tie';

			return results;
		}

		function renderHeadingTree(headings) {
			if (!headings || headings.length === 0) return '<span style="color:var(--text-muted)">No headings</span>';
			return headings.map(h => `
				<div class="heading-node ${h.tag || ''}">
					<span class="heading-tag">${h.tag}</span>
					${escapeHtml((h.text || '').substring(0, 50))}${(h.text || '').length > 50 ? '...' : ''}
					${h.children && h.children.length > 0 ? renderHeadingTree(h.children) : ''}
				</div>
			`).join('');
		}

		function renderSchemas(statsA, statsB) {
			const schemasA = statsA?.schemaStats || {};
			const schemasB = statsB?.schemaStats || {};
			const allTypes = new Set([
				...Object.keys(schemasA).filter(k => schemasA[k]),
				...Object.keys(schemasB).filter(k => schemasB[k])
			]);

			if (allTypes.size === 0) return '<span style="color:var(--text-muted)">No structured data</span>';

			return `<div class="schema-tags">${Array.from(allTypes).map(type => {
				const inA = schemasA[type];
				const inB = schemasB[type];
				let cls = 'both';
				if (inA && !inB) cls = 'page-a';
				else if (!inA && inB) cls = 'page-b';
				return `<span class="schema-tag ${cls}">${escapeHtml(type)}</span>`;
			}).join('')}</div>`;
		}

		function renderClassificationPanel(classification, side) {
			if (!classification) {
				return `<div class="classification-panel page-${side.toLowerCase()}">
					<h5>Page ${side}</h5>
					<div class="no-classification">No classification available</div>
				</div>`;
			}

			const themesHtml = (classification.themes || []).map(theme =>
				`<span class="theme-tag page-${side.toLowerCase()}">${escapeHtml(theme)}</span>`
			).join('');

			return `
				<div class="classification-panel page-${side.toLowerCase()}">
					<h5>Page ${side}</h5>
					<div class="classification-type">${escapeHtml(classification.type || 'Unknown')}</div>
					<div class="classification-subtype">${escapeHtml(classification.subtype || 'N/A')}</div>
					${classification.summary ? `<div class="classification-summary">${escapeHtml(classification.summary)}</div>` : ''}
					${themesHtml ? `<div class="themes-container">${themesHtml}</div>` : ''}
				</div>
			`;
		}

		function renderClassificationComparison(classA, classB) {
			const themesA = new Set(classA?.themes || []);
			const themesB = new Set(classB?.themes || []);
			const sharedThemes = [...themesA].filter(t => themesB.has(t));
			const uniqueA = [...themesA].filter(t => !themesB.has(t));
			const uniqueB = [...themesB].filter(t => !themesA.has(t));

			let themesComparisonHtml = '';
			if (sharedThemes.length > 0 || uniqueA.length > 0 || uniqueB.length > 0) {
				themesComparisonHtml = `
					<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
						<h4 style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Theme Comparison</h4>
						<div class="themes-container">
							${sharedThemes.map(t => `<span class="theme-tag shared" title="Shared">${escapeHtml(t)}</span>`).join('')}
							${uniqueA.map(t => `<span class="theme-tag page-a" title="Page A only">${escapeHtml(t)}</span>`).join('')}
							${uniqueB.map(t => `<span class="theme-tag page-b" title="Page B only">${escapeHtml(t)}</span>`).join('')}
						</div>
					</div>
				`;
			}

			return `
				<div class="classification-grid">
					${renderClassificationPanel(classA, 'A')}
					${renderClassificationPanel(classB, 'B')}
				</div>
				${themesComparisonHtml}
			`;
		}

		function compare() {
			if (!pageA || !pageB) return;

			const scores = computeScores();
			const titleA = pageA.content?.meta?.title || pageA.url;
			const titleB = pageB.content?.meta?.title || pageB.url;

			const winnerTitle = scores.winner === 'A' ? titleA :
							   scores.winner === 'B' ? titleB : 'Tie';
			const winnerClass = scores.winner === 'A' ? 'winner-a' :
							   scores.winner === 'B' ? 'winner-b' : 'tie';

			const pctA = Math.round((scores.totalA / scores.maxScore) * 100);
			const pctB = Math.round((scores.totalB / scores.maxScore) * 100);

			let html = `
				<div class="winner-banner ${winnerClass}">
					<div class="winner-label">${scores.winner === 'tie' ? 'Result' : 'SEO Winner'}</div>
					<div class="winner-title">${escapeHtml(winnerTitle.substring(0, 80))}</div>
					<div class="winner-score">${scores.winner === 'tie' ? 'TIE' : (scores.winner === 'A' ? pctA : pctB) + '%'}</div>
					<div class="score-breakdown">
						<div class="score-item page-a">
							<div class="label">Page A Score</div>
							<div class="value">${pctA}%</div>
						</div>
						<div class="score-item page-b">
							<div class="label">Page B Score</div>
							<div class="value">${pctB}%</div>
						</div>
					</div>
				</div>

				<div class="page-cards">
					<div class="page-card page-a">
						<h4>Page A</h4>
						<div class="url"><a href="${escapeHtml(pageA.url)}" target="_blank">${escapeHtml(pageA.url)}</a></div>
						<div class="title">${escapeHtml(titleA.substring(0, 100))}</div>
					</div>
					<div class="page-card page-b">
						<h4>Page B</h4>
						<div class="url"><a href="${escapeHtml(pageB.url)}" target="_blank">${escapeHtml(pageB.url)}</a></div>
						<div class="title">${escapeHtml(titleB.substring(0, 100))}</div>
					</div>
				</div>
			`;

			// Category sections
			for (const [catId, cat] of Object.entries(scores.categories)) {
				const winnerClass = cat.winner === 'A' ? 'page-a' : cat.winner === 'B' ? 'page-b' : 'tie';
				const winnerText = cat.winner === 'A' ? 'Page A wins' : cat.winner === 'B' ? 'Page B wins' : 'Tie';

				let metricsHtml = cat.metrics.map(m => {
					const verdictClass = m.winner === 'A' ? 'winner-a' : m.winner === 'B' ? 'winner-b' : 'tie';
					const verdictText = m.winner === 'A' ? 'A' : m.winner === 'B' ? 'B' : '=';
					const displayValA = m.compare === 'boolean' ? (m.valA ? '‚úì' : '‚úó') : m.valA;
					const displayValB = m.compare === 'boolean' ? (m.valB ? '‚úì' : '‚úó') : m.valB;

					return `
						<div class="metric-row">
							<div class="metric-name">
								${escapeHtml(m.name)}
								<div class="description">${escapeHtml(m.description)}</div>
							</div>
							<div class="metric-value page-a">${displayValA}</div>
							<div class="metric-value page-b">${displayValB}</div>
							<div class="metric-verdict">
								<span class="verdict-badge ${verdictClass}">${verdictText}</span>
							</div>
						</div>
					`;
				}).join('');

				// Add category-specific content
				let extraContent = '';

				if (catId === 'headings') {
					extraContent = `
						<div class="content-preview">
							<h4>Heading Structure Preview</h4>
							<div class="preview-grid">
								<div class="preview-panel page-a">
									<h5>Page A</h5>
									<div class="heading-tree">${renderHeadingTree(pageA.content?.headings)}</div>
								</div>
								<div class="preview-panel page-b">
									<h5>Page B</h5>
									<div class="heading-tree">${renderHeadingTree(pageB.content?.headings)}</div>
								</div>
							</div>
						</div>
					`;
				}

				if (catId === 'schema') {
					extraContent = `
						<div class="content-preview">
							<h4>Schema Types Comparison</h4>
							${renderSchemas(pageA.stats, pageB.stats)}
						</div>
					`;
				}

				if (catId === 'meta') {
					extraContent = `
						<div class="content-preview">
							<h4>Meta Content Preview</h4>
							<div class="preview-grid">
								<div class="preview-panel page-a">
									<h5>Page A</h5>
									<div><strong>Title:</strong> ${escapeHtml(pageA.content?.meta?.title || 'Not set')}</div>
									<div><strong>Description:</strong> ${escapeHtml(pageA.content?.meta?.description || 'Not set')}</div>
								</div>
								<div class="preview-panel page-b">
									<h5>Page B</h5>
									<div><strong>Title:</strong> ${escapeHtml(pageB.content?.meta?.title || 'Not set')}</div>
									<div><strong>Description:</strong> ${escapeHtml(pageB.content?.meta?.description || 'Not set')}</div>
								</div>
							</div>
						</div>
					`;
				}

				if (catId === 'classification') {
					extraContent = `
						<div class="content-preview">
							<h4>Page Classification Details</h4>
							${renderClassificationComparison(pageA.classification, pageB.classification)}
						</div>
					`;
				}

				html += `
					<div class="category">
						<div class="category-header" data-category="${catId}">
							<h3>${cat.name}</h3>
							<div class="category-score">
								<span class="category-winner ${winnerClass}">${winnerText}</span>
								<span class="chevron">‚ñº</span>
							</div>
						</div>
						<div class="category-content">
							${metricsHtml}
							${extraContent}
						</div>
					</div>
				`;
			}

			// SEO Issues Summary
			if (scores.issuesA.length > 0 || scores.issuesB.length > 0) {
				html += `
					<div class="category">
						<div class="category-header" data-category="issues">
							<h3>‚ö†Ô∏è SEO Issues Found</h3>
							<div class="category-score">
								<span style="color:var(--text-secondary)">${scores.issuesA.length + scores.issuesB.length} issues</span>
								<span class="chevron">‚ñº</span>
							</div>
						</div>
						<div class="category-content">
							<div class="preview-grid">
								<div class="preview-panel page-a" style="max-height:300px">
									<h5>Page A Issues (${scores.issuesA.length})</h5>
									${scores.issuesA.length === 0 ? '<div style="color:var(--success)">No issues!</div>' :
									scores.issuesA.map(i => `
										<div class="issue-item page-a">
											<span class="icon">‚ö†</span>
											<div><strong>${escapeHtml(i.metric)}</strong>: ${escapeHtml(i.issue)}</div>
										</div>
									`).join('')}
								</div>
								<div class="preview-panel page-b" style="max-height:300px">
									<h5>Page B Issues (${scores.issuesB.length})</h5>
									${scores.issuesB.length === 0 ? '<div style="color:var(--success)">No issues!</div>' :
									scores.issuesB.map(i => `
										<div class="issue-item page-b">
											<span class="icon">‚ö†</span>
											<div><strong>${escapeHtml(i.metric)}</strong>: ${escapeHtml(i.issue)}</div>
										</div>
									`).join('')}
								</div>
							</div>
						</div>
					</div>
				`;
			}

			dashboard.innerHTML = html;
			dashboard.classList.add('visible');

			// Add click handlers for expandable sections
			document.querySelectorAll('.category-header').forEach(header => {
				header.addEventListener('click', () => {
					header.classList.toggle('open');
					header.nextElementSibling.classList.toggle('open');
				});
			});

			// Open first section by default
			const firstHeader = document.querySelector('.category-header');
			if (firstHeader) {
				firstHeader.classList.add('open');
				firstHeader.nextElementSibling.classList.add('open');
			}

			showMessage('Comparison complete!', 'success');
		}

		// Event Listeners
		fileInputA.addEventListener('change', async (e) => {
			const file = e.target.files[0];
			if (file) {
				loadPage('A', await file.text());
				fileInputA.value = '';
			}
		});

		fileInputB.addEventListener('change', async (e) => {
			const file = e.target.files[0];
			if (file) {
				loadPage('B', await file.text());
				fileInputB.value = '';
			}
		});

		pasteA.addEventListener('click', () => {
			jsonInputA.classList.toggle('visible');
			if (jsonInputA.classList.contains('visible')) jsonInputA.focus();
		});

		pasteB.addEventListener('click', () => {
			jsonInputB.classList.toggle('visible');
			if (jsonInputB.classList.contains('visible')) jsonInputB.focus();
		});

		jsonInputA.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
				loadPage('A', jsonInputA.value);
			}
		});

		jsonInputB.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
				loadPage('B', jsonInputB.value);
			}
		});

		clearA.addEventListener('click', () => clearPage('A'));
		clearB.addEventListener('click', () => clearPage('B'));
		compareBtn.addEventListener('click', compare);

		// Global paste handler
		document.addEventListener('paste', (e) => {
			if (document.activeElement === jsonInputA || document.activeElement === jsonInputB) return;

			const text = e.clipboardData.getData('text');
			if (!text) return;

			try {
				parseJSON(text);
				if (!pageA) loadPage('A', text);
				else if (!pageB) loadPage('B', text);
			} catch (err) {
				// Ignore invalid JSON
			}
		});

		// Keyboard shortcut
		document.addEventListener('keydown', (e) => {
			if ((e.metaKey || e.ctrlKey) && e.key === 'Enter' && pageA && pageB) {
				compare();
			}
		});
	</script>
</body>
</html>
